# WASM Memory Scanner 使用说明

## 功能概述

这是一个类似 Cheat Engine 的浏览器扩展，可以在网页中的 WebAssembly 内存中搜索和修改数值。

## 安装步骤

1. 打开 Chrome 浏览器
2. 访问 `chrome://extensions`
3. 打开右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择 `/Users/yinyue/flyff/FlyffBot/wasm/extension` 文件夹
6. 扩展安装完成！

## 使用流程

### 1. 启动游戏并等待加载

- 打开 Flyff Universe 游戏页面：https://universe.flyff.com/play
- **等待游戏完全加载**（看到角色和游戏界面）
- 插件会在页面加载后 3 秒自动注入扫描器

### 2. 打开插件面板

- 点击浏览器工具栏中的扩展图标
- 看到插件弹窗

### 3. 检查连接状态

- 如果显示 **"未连接"**：
  - 点击 **"注入扫描器"** 按钮
  - 或点击 **"🔄 刷新"** 按钮触发重新扫描
- 如果显示 **"已连接 (1 个实例)"**：
  - 说明已成功检测到 WASM 内存，可以开始扫描！

### 4. 首次扫描

假设你想找到游戏中 HP（生命值）的内存地址：

1. 查看游戏中的当前 HP 值，例如：**950**
2. 在插件的"快速扫描"输入框中输入：`950`
3. 选择数据类型（通常是 `Int32`）
4. 点击 **"首次扫描"** 按钮
5. 等待扫描完成，会显示找到的结果数量，例如：**"结果: 1234"**

💡 **提示**：如果结果太多（超过 1000），需要继续扫描缩小范围。

### 5. 继续扫描

1. 在游戏中改变 HP 值（例如被怪物攻击或使用药水）
2. 查看新的 HP 值，例如：**920**
3. 在输入框中输入新值：`920`
4. 点击 **"继续扫描"** 按钮
5. 结果数量会减少，例如：**"剩余 156 个结果"**

重复这个过程，直到结果缩小到很少（10 个以内）。

💡 **提示**：每次改变游戏中的值后，立即继续扫描，效果最好。

### 6. 关闭插件后恢复结果

- **新功能！** 现在关闭插件弹窗后，之前的扫描结果会被保留
- 重新打开插件时，会自动显示上次的扫描结果数量
- 可以继续进行扫描，无需从头开始

## 高级功能

### 使用开发者面板（DevTools）

1. 按 **F12** 打开浏览器开发者工具
2. 切换到 **"WASM Scanner"** 标签页
3. 可以看到：
   - 完整的扫描结果列表（包含内存地址）
   - 每个地址的当前值
   - 修改内存值的功能

### 在控制台中手动操作

打开浏览器控制台（F12 → Console），可以使用以下调试接口：

```javascript
// 查看所有捕获的内存实例
window.__wasmScannerDebug__.getMemories()

// 查看所有扫描器
window.__wasmScannerDebug__.getScanners()

// 获取当前使用的扫描器
window.__wasmScannerDebug__.getCurrentScanner()

// 手动触发扫描
window.__wasmScannerDebug__.scan()
```

### 修改内存值

⚠️ **警告**：修改游戏内存可能违反游戏服务条款，请谨慎使用！

在开发者面板中：
1. 找到目标地址
2. 点击"修改"按钮
3. 输入新值
4. 游戏中的值会立即改变

## 常见问题

### Q: 显示"未连接"怎么办？

**A:** 按以下步骤排查：

1. **确认游戏已完全加载**
   - 能看到角色和游戏界面
   - 不要在加载画面时打开插件

2. **手动触发扫描**
   - 点击 "注入扫描器" 按钮
   - 点击 "🔄 刷新" 按钮
   - 等待 2-3 秒后再次点击刷新

3. **查看控制台日志**
   - 按 F12 打开开发者工具
   - 切换到 Console 标签
   - 搜索 `[WASM Scanner]`
   - 查看是否有 "Found Module" 或 "Found buffer" 的消息

4. **重新加载页面**
   - 刷新游戏页面（F5）
   - 等待完全加载后再打开插件

### Q: 游戏卡死/浏览器冻结怎么办？

**A:** 新版本已修复此问题！如果仍然遇到：

1. **重新加载插件**
   - 访问 `chrome://extensions`
   - 找到 WASM Memory Scanner
   - 点击刷新图标 🔄

2. **检查 manifest.json**
   - 确认 `run_at` 是 `"document_idle"`
   - 确认 `matches` 是 `["*://universe.flyff.com/*"]`

### Q: 扫描结果太多怎么办？

**A:** 使用以下技巧缩小范围：

1. **多次继续扫描**
   - 改变游戏中的值
   - 立即进行继续扫描
   - 重复 3-5 次

2. **选择正确的数据类型**
   - HP/MP 通常是 `Int32` 或 `UInt32`
   - 金币/经验可能是 `UInt32` 或 `Float32`
   - 坐标通常是 `Float32`

3. **搜索不常见的值**
   - 避免搜索 0、1、100 等常见值
   - 选择比较特殊的数值

### Q: 找到的地址不对/修改无效怎么办？

**A:** 可能的原因：

1. **地址不是真正的数据**
   - 可能是中间计算值或缓存
   - 尝试其他匹配的地址

2. **游戏有验证机制**
   - 服务器端验证（无法绕过）
   - 客户端有额外的校验逻辑

3. **内存动态分配**
   - WASM 内存可能会增长/移动
   - 需要重新扫描找到新地址

## 技术说明

### 工作原理

1. **拦截 WebAssembly**
   - 插件在页面加载时拦截 `WebAssembly.instantiate` 和 `WebAssembly.instantiateStreaming`
   - 自动捕获所有创建的 WASM Memory 实例

2. **内存扫描**
   - 使用 `DataView` 读取 WASM 内存的原始字节
   - 按照指定的数据类型解析每个地址的值
   - 比较值并存储匹配的地址

3. **继续扫描**
   - 只在上次的结果中继续搜索
   - 大大提高扫描速度

### 支持的数据类型

| 类型 | 大小 | 范围 | 常用于 |
|------|------|------|--------|
| Int8 | 1 字节 | -128 ~ 127 | 小整数、标志 |
| UInt8 | 1 字节 | 0 ~ 255 | 小整数 |
| Int16 | 2 字节 | -32768 ~ 32767 | 中等整数 |
| UInt16 | 2 字节 | 0 ~ 65535 | 中等整数 |
| Int32 | 4 字节 | -2^31 ~ 2^31-1 | HP、MP、等级 |
| UInt32 | 4 字节 | 0 ~ 2^32-1 | 金币、经验 |
| Float32 | 4 字节 | 浮点数 | 坐标、速度 |
| Float64 | 8 字节 | 双精度浮点 | 高精度数值 |

## 更新日志

查看 [CHANGELOG.md](./CHANGELOG.md) 了解详细的版本更新信息。

## 免责声明

⚠️ **重要提示**：

- 本工具仅供学习和研究 WebAssembly 技术使用
- 使用本工具修改游戏数据可能违反游戏服务条款
- 可能导致账号被封禁或其他处罚
- 作者不对因使用本工具造成的任何后果负责
- 请合法、合理地使用本工具

## 支持与反馈

如有问题或建议，请查看控制台日志并提供详细信息。
