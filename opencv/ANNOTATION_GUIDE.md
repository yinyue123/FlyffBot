# 标注位置说明 - Annotation Guide

## 📍 标注显示在哪里？

当你运行 `test_shape.py` 后，会看到一个 **2x2 网格** 的显示窗口，包含4个子图：

```
┌─────────────────────┬─────────────────────┐
│  1. Original + ROI  │  2. Grayscale (ROI) │
│  (原图+ROI框)        │  (灰度图)            │
├─────────────────────┼─────────────────────┤
│ 3. Edge/Denoised    │ 4. ★ RESULT ★       │  ← 看这里！
│ (边缘/去噪)          │ (检测结果+标注)      │
└─────────────────────┴─────────────────────┘
```

**✅ 标注显示在右下角的 "RESULT" 图中！**

## 🎯 标注内容

在右下角的结果图上，每个检测到的形状都会显示：

### 1. **边界框（Bounding Box）**
- 彩色矩形框框住整个形状
- 四个角有 L 形标记，更清晰

### 2. **中心点编号**
- 形状中心有一个实心圆点
- 圆点中间显示编号（1, 2, 3...）
- 白色数字，黑色边框

### 3. **信息标签（Label）**
显示在形状上方或下方，包含两行：
- **第一行（彩色）**: `#1 Triangle` - 编号和形状名称
- **第二行（白色）**: `V=3 A=1234 50x60` - 顶点数、面积、尺寸

### 4. **轮廓和顶点**
- 彩色轮廓线沿着形状边缘
- 红色小圆点标记轮廓顶点

## 📊 示例标注

```
  ┌─────────────────┐
  │ #1 Square       │  ← 信息标签（半透明黑底）
  │ V=4 A=2500      │
  │ 50x50           │
  └─────────────────┘
        ↓
    ┏━━━━━┓          ← 绿色边界框+角标记
    ┃  1  ┃          ← 中心点编号
    ┗━━━━━┛
```

## 🔍 如何使用

### 方法一：轮廓检测

1. 运行程序：
```bash
python test_shape.py
```

2. 选择方法 `1`

3. 输入图像路径

4. 调整参数滑块：
   - **ROI_X/Y/Width/Height** - 选择检测区域（绿色框）
   - **Min Area** / **Max Area** - 限制形状大小范围
   - **Blur Type** / **Kernel Size** - 去噪设置
   - **Edge Type** / **Threshold** - 边缘检测设置
   - **Epsilon** - 轮廓精度（影响顶点数）

5. **观察右下角的 "RESULT" 窗口**：
   - 每个检测到的形状都被框出来
   - 标签显示形状信息
   - 中心点显示编号

6. **查看控制台输出**：
```
============================================================
Detected 3 shapes in ROI(800x600), Time: 15.2ms
============================================================
Shape Details:
  #1 Square: V=4 A=2500 50x50 at (100,200)
  #2 Circle: V=12 A=3142 60x60 at (300,400)
  #3 Triangle: V=3 A=1800 40x50 at (500,100)
============================================================
✓ Labels are drawn on the BOTTOM-RIGHT image (Detection Result)
  - Bounding boxes with corner markers around each shape
  - Shape ID number at the center
  - Label with details above/below the shape
============================================================
```

## 🎨 颜色说明

不同形状用不同颜色标记：

- 🔵 **蓝色** - Triangle (三角形)
- 🟡 **黄色** - Square (正方形)
- 🔷 **青色** - Rectangle (矩形)
- 🟣 **洋红** - Pentagon (五边形)
- 🟢 **绿色** - Circle (圆形)
- 🟪 **紫色** - Polygon (多边形)
- ⚪ **灰色** - Unknown (未知)

## 📝 标注信息说明

标签上的信息含义：

- `#1` - 形状编号（检测顺序）
- `Square` - 形状类型
- `V=4` - Vertices (顶点数)
- `A=2500` - Area (面积，像素)
- `50x50` - 宽度x高度（边界框尺寸）

## ❓ 如果看不到标注

### 1. **检查是否有检测到形状**
控制台会显示：
```
Detected 0 shapes in ROI(...)
No shapes detected. Try adjusting parameters.
```

如果是0个，需要调整参数：
- 降低 `Min Area`
- 增大 `Max Area`
- 调整 `Threshold1/2` 使边缘更清晰
- 调整 `Epsilon` 改变轮廓精度

### 2. **检查ROI区域**
- 左上角的 "Original + ROI" 窗口显示绿色ROI框
- 确保ROI框包含了你要检测的物体
- 按 `r` 键重置ROI到全图

### 3. **检查窗口大小**
- 窗口默认 1600x900，可以手动拉伸
- 如果图像太大，标注可能显得很小
- 可以全屏查看窗口

### 4. **保存结果查看**
- 按 `s` 键保存结果图像
- 用图像查看器打开保存的图片
- 可以放大查看标注细节

## 🔧 调试技巧

1. **从简单开始**：
   - 先用 Min Area=500, Max Area=50000
   - 使用默认的 Canny 边缘检测
   - ROI 设为全图

2. **观察中间步骤**：
   - 左上：检查ROI是否正确
   - 右上：灰度图应该清晰
   - 左下：边缘应该连续、清晰
   - 右下：**最终结果+标注**

3. **逐步调整**：
   - 先调整边缘检测，让边缘清晰
   - 再调整面积范围，过滤不需要的
   - 最后调整Epsilon，优化顶点数

## 💡 快捷键

- `q` / `ESC` - 退出程序
- `s` - 保存当前显示的图像
- `r` - 重置ROI到全图

## 📸 结果示例

保存的图像文件名格式：
```
shape_detection_20251102_143025.png
```

这个文件包含完整的2x2网格，可以直接用于：
- 文档报告
- 参数调试记录
- 结果展示

---

**记住：标注总是显示在右下角的 "★ RESULT ★" 窗口中！**
