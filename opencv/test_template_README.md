# æ¨¡æ¿åŒ¹é…è°ƒè¯•å·¥å…·ä½¿ç”¨è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

`test_template.py` æ˜¯ä¸€ä¸ªäº¤äº’å¼çš„æ¨¡æ¿åŒ¹é…è°ƒè¯•å·¥å…·ï¼Œç±»ä¼¼äº `test_hsv.py`ï¼Œç”¨äºå¸®åŠ©ä½ å¿«é€Ÿæ‰¾åˆ°æœ€ä½³çš„æ¨¡æ¿åŒ¹é…å‚æ•°ã€‚

## ä¸»è¦åŠŸèƒ½

### âœ… æ ¸å¿ƒåŠŸèƒ½
- ğŸ“¸ **åŒå›¾åƒè¾“å…¥**ï¼šæ”¯æŒæ¨¡æ¿å›¾åƒå’Œå¾…æ£€æµ‹å›¾åƒ
- ğŸ¯ **å¤šå°ºåº¦åŒ¹é…**ï¼šè‡ªåŠ¨åœ¨å¤šä¸ªå°ºåº¦ä¸‹æœç´¢æ¨¡æ¿
- ğŸ”§ **6ç§åŒ¹é…æ–¹æ³•**ï¼šæ”¯æŒOpenCVæ‰€æœ‰æ¨¡æ¿åŒ¹é…ç®—æ³•
- ğŸ“Š **4ç§ç»“æœå¤„ç†**ï¼šNMSã€æœ€ä½³åŒ¹é…ã€å‰Nä¸ªã€æ˜¾ç¤ºå…¨éƒ¨
- ğŸ›ï¸ **å®æ—¶å‚æ•°è°ƒèŠ‚**ï¼šé€šè¿‡æ»‘å—å®æ—¶è°ƒæ•´æ‰€æœ‰å‚æ•°
- ğŸ‘ï¸ **3ç§è§†å›¾æ¨¡å¼**ï¼šç»“æœå›¾ã€åŸå›¾+ROIã€çƒ­åŠ›å›¾
- ğŸ” **ROIåŒºåŸŸé€‰æ‹©**ï¼šåªåœ¨æŒ‡å®šåŒºåŸŸæœç´¢ï¼Œæå‡æ€§èƒ½
- âš¡ **é™ä½åˆ†è¾¨ç‡**ï¼šå¯é€‰æ‹©é™ä½åˆ†è¾¨ç‡åŠ é€Ÿå¤„ç†

## ä½¿ç”¨æ–¹æ³•

### 1. è¿è¡Œç¨‹åº

```bash
python test_template.py
```

### 2. è¾“å…¥å›¾åƒè·¯å¾„

ç¨‹åºä¼šä¾æ¬¡æç¤ºè¾“å…¥ä¸¤ä¸ªè·¯å¾„ï¼š

```
è¯·è¾“å…¥æ¨¡æ¿å›¾ç‰‡è·¯å¾„: /path/to/template.png
è¯·è¾“å…¥å¾…æ£€æµ‹å›¾ç‰‡è·¯å¾„: /path/to/image.png
```

**æç¤º**ï¼šå¯ä»¥ç›´æ¥æ‹–æ‹½å›¾ç‰‡åˆ°ç»ˆç«¯çª—å£ï¼

### 3. è°ƒæ•´å‚æ•°

ç¨‹åºä¼šæ‰“å¼€ä¸¤ä¸ªçª—å£ï¼š
- **Trackbars**ï¼šæ»‘å—æ§åˆ¶çª—å£
- **Display**ï¼šå›¾åƒæ˜¾ç¤ºçª—å£

## å‚æ•°è¯´æ˜

### ğŸ¯ åŒ¹é…æ–¹æ³• (Method)

| å€¼ | æ–¹æ³• | è¯´æ˜ | é˜ˆå€¼æ–¹å‘ |
|----|------|------|---------|
| 0 | TM_CCOEFF_NORMED | å½’ä¸€åŒ–ç›¸å…³ç³»æ•°ï¼ˆæ¨èï¼‰ | å€¼è¶Šå¤§è¶Šå¥½ |
| 1 | TM_CCORR_NORMED | å½’ä¸€åŒ–ç›¸å…³ | å€¼è¶Šå¤§è¶Šå¥½ |
| 2 | TM_SQDIFF_NORMED | å½’ä¸€åŒ–å¹³æ–¹å·® | å€¼è¶Šå°è¶Šå¥½ |
| 3 | TM_CCOEFF | ç›¸å…³ç³»æ•° | å€¼è¶Šå¤§è¶Šå¥½ |
| 4 | TM_CCORR | ç›¸å…³ | å€¼è¶Šå¤§è¶Šå¥½ |
| 5 | TM_SQDIFF | å¹³æ–¹å·® | å€¼è¶Šå°è¶Šå¥½ |

**æ¨è**ï¼šä¸€èˆ¬ä½¿ç”¨ `Method = 0 (TM_CCOEFF_NORMED)`

### ğŸ“ é˜ˆå€¼ (Threshold%)

- **èŒƒå›´**ï¼š0-100 (å®é™…å€¼ = æ»‘å—å€¼/100)
- **è¯´æ˜**ï¼šåŒ¹é…çš„ç½®ä¿¡åº¦é˜ˆå€¼
- **æ¨èå€¼**ï¼š
  - ç²¾ç¡®åŒ¹é…ï¼š85-95
  - ä¸€èˆ¬åŒ¹é…ï¼š75-85
  - å®½æ¾åŒ¹é…ï¼š65-75

### ğŸ” å¤šå°ºåº¦å‚æ•°

#### Scale_Min% / Scale_Max%
- **èŒƒå›´**ï¼š0-200 (å®é™…å€¼ = æ»‘å—å€¼/100)
- **è¯´æ˜**ï¼šæ¨¡æ¿ç¼©æ”¾çš„æœ€å°å’Œæœ€å¤§æ¯”ä¾‹
- **ç¤ºä¾‹**ï¼š
  - 80-120 = æ¨¡æ¿ä»80%åˆ°120%å¤§å°æœç´¢ï¼ˆæ¨èï¼‰
  - 50-150 = ä»50%åˆ°150%ï¼ˆå¤§èŒƒå›´æœç´¢ï¼‰
  - 90-110 = åªåœ¨æ¥è¿‘åŸå§‹å¤§å°é™„è¿‘æœç´¢ï¼ˆå¿«é€Ÿï¼‰

#### Scale_Steps
- **èŒƒå›´**ï¼š1-30
- **è¯´æ˜**ï¼šåœ¨minå’Œmaxä¹‹é—´å°è¯•å¤šå°‘ä¸ªå°ºåº¦
- **æ¨èå€¼**ï¼š
  - å¿«é€Ÿæœç´¢ï¼š3-5 æ­¥
  - å¹³è¡¡ï¼š5-10 æ­¥
  - ç²¾ç¡®æœç´¢ï¼š15-20 æ­¥

**æ€§èƒ½æç¤º**ï¼šæ­¥æ•°è¶Šå¤šè¶Šæ…¢ï¼Œä½†æ›´å®¹æ˜“æ‰¾åˆ°ç›®æ ‡ï¼

### ğŸ“Š ç»“æœå¤„ç† (Result_Method)

| å€¼ | æ–¹æ³• | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|----|------|------|---------|
| 0 | NMS | éæå¤§å€¼æŠ‘åˆ¶ï¼Œå»é™¤é‡å æ£€æµ‹ | å¤šç›®æ ‡æ£€æµ‹ï¼ˆæ¨èï¼‰ |
| 1 | æœ€ä½³åŒ¹é… | åªæ˜¾ç¤ºå¾—åˆ†æœ€é«˜çš„ä¸€ä¸ª | åªéœ€è¦æ‰¾ä¸€ä¸ªç›®æ ‡ |
| 2 | å‰Nä¸ª | æ˜¾ç¤ºå¾—åˆ†æœ€é«˜çš„Nä¸ª | éœ€è¦æ‰¾å¤šä¸ªç›®æ ‡ |
| 3 | æ˜¾ç¤ºå…¨éƒ¨ | æ˜¾ç¤ºæ‰€æœ‰ç¬¦åˆé˜ˆå€¼çš„ | è°ƒè¯•ç”¨ |

### ğŸ›ï¸ å…¶ä»–å‚æ•°

#### Top_N
- **èŒƒå›´**ï¼š1-50
- **è¯´æ˜**ï¼šå½“Result_Method=2æ—¶ï¼Œæ˜¾ç¤ºå‰Nä¸ªåŒ¹é…
- **æ¨è**ï¼š5-10

#### NMS_Thresh%
- **èŒƒå›´**ï¼š0-100 (å®é™…å€¼ = æ»‘å—å€¼/100)
- **è¯´æ˜**ï¼šNMSçš„IoUé˜ˆå€¼ï¼Œè¶Šå°å»é‡è¶Šä¸¥æ ¼
- **æ¨èå€¼**ï¼š
  - ä¸¥æ ¼å»é‡ï¼š20-30
  - å¹³è¡¡ï¼š30-40
  - å®½æ¾ï¼š40-50

#### Resize%
- **èŒƒå›´**ï¼š10-100 (å®é™…å€¼ = æ»‘å—å€¼/100)
- **è¯´æ˜**ï¼šé™ä½å›¾åƒåˆ†è¾¨ç‡åŠ é€Ÿå¤„ç†
- **æ¨èå€¼**ï¼š
  - ä¸é™ä½ï¼š100ï¼ˆé»˜è®¤ï¼‰
  - å¿«é€Ÿæ¨¡å¼ï¼š50-70
  - è¶…å¿«æ¨¡å¼ï¼š30-50

**æ³¨æ„**ï¼šé™ä½åˆ†è¾¨ç‡ä¼šå½±å“å°ç›®æ ‡æ£€æµ‹ï¼

#### Timeout_ms âš ï¸ æ–°åŠŸèƒ½
- **èŒƒå›´**ï¼š100-5000 (æ¯«ç§’)
- **è¯´æ˜**ï¼šå¤„ç†è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´ä¼šè‡ªåŠ¨è·³è¿‡å‰©ä½™å°ºåº¦
- **æ¨èå€¼**ï¼š
  - å¿«é€Ÿå“åº”ï¼š500-1000msï¼ˆé»˜è®¤1000msï¼‰
  - å¹³è¡¡æ¨¡å¼ï¼š1000-2000ms
  - ç²¾ç¡®æœç´¢ï¼š2000-5000ms

**ç”¨é€”**ï¼š
- é˜²æ­¢æŸäº›å‚æ•°ç»„åˆå¯¼è‡´å¤„ç†æ—¶é—´è¿‡é•¿å¡ä½ç•Œé¢
- å½“å‡ºç°çº¢è‰² "WARNING: TIMEOUT!" æç¤ºæ—¶ï¼Œè¯´æ˜å‚æ•°ç»„åˆå¤ªæ…¢
- å»ºè®®é™ä½ Scale_Steps æˆ– Resize% æ¥åŠ é€Ÿ

**è¶…æ—¶æ—¶çš„è¡Œä¸º**ï¼š
- åœæ­¢å¤„ç†å‰©ä½™å°ºåº¦
- è¿”å›å·²æ‰¾åˆ°çš„åŒ¹é…ç»“æœ
- åœ¨ç•Œé¢æ˜¾ç¤ºçº¢è‰²è¶…æ—¶è­¦å‘Š

### ğŸ“ ROIåŒºåŸŸ (Region of Interest)

- **ROI_X, ROI_Y**ï¼šæœç´¢åŒºåŸŸå·¦ä¸Šè§’åæ ‡
- **ROI_W, ROI_H**ï¼šæœç´¢åŒºåŸŸå®½åº¦å’Œé«˜åº¦

**ä½¿ç”¨åœºæ™¯**ï¼š
- åªåœ¨å±å¹•ç‰¹å®šåŒºåŸŸæŸ¥æ‰¾ï¼ˆå¦‚æ¸¸æˆä¸­çš„æŠ€èƒ½æ ï¼‰
- æå‡æ€§èƒ½ï¼Œå‡å°‘è¯¯æ£€

### ğŸ–¼ï¸ è§†å›¾æ¨¡å¼ (View)

| å€¼ | æ¨¡å¼ | è¯´æ˜ |
|----|------|------|
| 0 | Result | åœ¨ROIåŒºåŸŸæ˜¾ç¤ºåŒ¹é…ç»“æœï¼ˆé»˜è®¤ï¼‰ |
| 1 | Original+ROI | åœ¨å®Œæ•´åŸå›¾ä¸Šæ˜¾ç¤ºROIæ¡† |
| 2 | Heatmap | æ˜¾ç¤ºåŒ¹é…çƒ­åŠ›å›¾ï¼ˆçº¢è‰²=é«˜åŒ¹é…ï¼‰ |

### ğŸ“º æ˜¾ç¤ºç¼©æ”¾ (Display%)

- **èŒƒå›´**ï¼š10-400
- **è¯´æ˜**ï¼šåªå½±å“æ˜¾ç¤ºï¼Œä¸å½±å“æ£€æµ‹
- **ç”¨é€”**ï¼šæ”¾å¤§æŸ¥çœ‹ç»†èŠ‚æˆ–ç¼©å°æŸ¥çœ‹å…¨å›¾

## å¿«æ·é”®

| æŒ‰é”® | åŠŸèƒ½ |
|-----|------|
| `q` | é€€å‡ºå¹¶æ‰“å°æœ€ç»ˆå‚æ•°ä»£ç  |
| `s` | ä¿å­˜å½“å‰æ˜¾ç¤ºçš„å›¾åƒ |

## ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯1ï¼šæ¸¸æˆUIå…ƒç´ æ£€æµ‹

å‡è®¾ä½ è¦åœ¨æ¸¸æˆä¸­æ‰¾æŠ€èƒ½å›¾æ ‡ï¼š

1. **è¾“å…¥å›¾åƒ**ï¼š
   - æ¨¡æ¿ï¼šskill_icon.png (æŠ€èƒ½å›¾æ ‡æˆªå›¾)
   - ç›®æ ‡ï¼šgame_screenshot.png (æ¸¸æˆæˆªå›¾)

2. **å‚æ•°è®¾ç½®**ï¼š
   ```
   Method = 0 (TM_CCOEFF_NORMED)
   Threshold% = 85
   Scale_Min% = 90
   Scale_Max% = 110
   Scale_Steps = 5
   Result_Method = 0 (NMS)
   NMS_Thresh% = 30
   Resize% = 100
   ```

3. **ROIè®¾ç½®**ï¼š
   - åªåœ¨æŠ€èƒ½æ åŒºåŸŸæœç´¢
   - ä¾‹å¦‚ï¼šROI_X=0, ROI_Y=800, ROI_W=1920, ROI_H=200

### åœºæ™¯2ï¼šç‰©å“æ£€æµ‹

åœ¨å¤æ‚åœºæ™¯ä¸­æ‰¾ç‰©å“ï¼š

1. **å‚æ•°è®¾ç½®**ï¼š
   ```
   Method = 0
   Threshold% = 75  # è¾ƒä½é˜ˆå€¼ï¼Œå…è®¸ä¸€å®šå˜åŒ–
   Scale_Min% = 70
   Scale_Max% = 130
   Scale_Steps = 10  # æ›´å¤šæ­¥æ•°
   Result_Method = 2 (å‰Nä¸ª)
   Top_N = 10
   Resize% = 100
   ```

2. **ä½¿ç”¨çƒ­åŠ›å›¾**ï¼š
   - åˆ‡æ¢åˆ° View=2 æŸ¥çœ‹å“ªäº›åŒºåŸŸåŒ¹é…åº¦é«˜

### åœºæ™¯3ï¼šå¿«é€Ÿæœç´¢

éœ€è¦å¿«é€Ÿå¤„ç†å¤§é‡å›¾åƒï¼š

1. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   ```
   Scale_Steps = 3  # å°‘é‡æ­¥æ•°
   Result_Method = 1 (æœ€ä½³åŒ¹é…)
   Resize% = 50  # é™ä½åˆ†è¾¨ç‡
   ```

2. **ä½¿ç”¨ROI**ï¼š
   - ç¼©å°æœç´¢èŒƒå›´

## è¾“å‡ºç¤ºä¾‹

æŒ‰ `q` é€€å‡ºåï¼Œç¨‹åºä¼šè¾“å‡ºå¯ç›´æ¥ä½¿ç”¨çš„Pythonä»£ç ï¼š

```python
============================================================
æœ€ç»ˆå‚æ•°:
============================================================

# åŒ¹é…æ–¹æ³•: TM_CCOEFF_NORMED
method = cv2.TM_CCOEFF_NORMED

# åŒ¹é…é˜ˆå€¼ (å€¼è¶Šå¤§è¶Šå¥½)
threshold = 0.85

# å¤šå°ºåº¦å‚æ•°
scale_min = 0.90
scale_max = 1.10
scale_steps = 5
scales = np.linspace(0.9, 1.1, 5)

# ç»“æœå¤„ç†: NMS (éæå¤§å€¼æŠ‘åˆ¶)
# ä½¿ç”¨ NMS éæå¤§å€¼æŠ‘åˆ¶
nms_threshold = 0.30

# æ€§èƒ½ä¼˜åŒ–
resize_factor = 1.00  # å›¾åƒç¼©æ”¾æ¯”ä¾‹
timeout = 1.00  # ç§’ï¼Œè¶…æ—¶ä¼šè·³è¿‡å‰©ä½™å°ºåº¦

# ROIæœç´¢åŒºåŸŸ (x, y, width, height)
roi_region = (0, 800, 1920, 200)

# å®Œæ•´ç¤ºä¾‹ä»£ç 
# result = cv2.matchTemplate(image_gray, template_gray, cv2.TM_CCOEFF_NORMED)
# locations = np.where(result >= 0.85)
============================================================
```

## è°ƒè¯•æŠ€å·§

### 1. æ‰¾ä¸åˆ°ç›®æ ‡ï¼Ÿ

**æ£€æŸ¥æ¸…å•**ï¼š
- âœ… é˜ˆå€¼æ˜¯å¦å¤ªé«˜ï¼Ÿå°è¯•é™ä½åˆ°70-75
- âœ… å°ºåº¦èŒƒå›´æ˜¯å¦å¤Ÿå¤§ï¼Ÿæ‰©å¤§Scale_Minå’ŒScale_Max
- âœ… å¢åŠ Scale_Stepsï¼Œå°è¯•æ›´å¤šå°ºåº¦
- âœ… åˆ‡æ¢åˆ°çƒ­åŠ›å›¾(View=2)çœ‹çœ‹åŒ¹é…åˆ†å¸ƒ
- âœ… ç¡®è®¤æ¨¡æ¿å›¾åƒå’Œç›®æ ‡å›¾åƒçš„é¢œè‰²/å…‰ç…§æ˜¯å¦ä¸€è‡´

### 2. å¤ªå¤šè¯¯æ£€ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… æé«˜é˜ˆå€¼åˆ°85-90
- âœ… ä½¿ç”¨NMSæ–¹æ³•(Result_Method=0)
- âœ… é™ä½NMS_Thresh%åˆ°20-30
- âœ… ä½¿ç”¨ROIé™åˆ¶æœç´¢åŒºåŸŸ
- âœ… å‡å°‘ScaleèŒƒå›´ï¼Œåªåœ¨ç›®æ ‡å¯èƒ½çš„å°ºåº¦æœç´¢

### 3. é€Ÿåº¦å¤ªæ…¢ï¼Ÿ

**ä¼˜åŒ–æ–¹æ³•**ï¼š
- âœ… é™ä½Resize%åˆ°50-70
- âœ… å‡å°‘Scale_Stepsåˆ°3-5
- âœ… ç¼©å°ScaleèŒƒå›´
- âœ… ä½¿ç”¨ROIå‡å°æœç´¢åŒºåŸŸ
- âœ… å¦‚æœåªéœ€è¦ä¸€ä¸ªç›®æ ‡ï¼Œç”¨Result_Method=1
- âœ… é™ä½Timeout_msåˆ°500-800msï¼Œå¼ºåˆ¶è·³è¿‡æ…¢é€Ÿå¤„ç†

### 3.5. å‡ºç°è¶…æ—¶è­¦å‘Šï¼Ÿâš ï¸

**é—®é¢˜**ï¼šç•Œé¢æ˜¾ç¤ºçº¢è‰² "WARNING: TIMEOUT!"

**åŸå› **ï¼šå½“å‰å‚æ•°ç»„åˆå¯¼è‡´å¤„ç†æ—¶é—´è¶…è¿‡è®¾å®šçš„è¶…æ—¶æ—¶é—´

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **å¢åŠ è¶…æ—¶æ—¶é—´**ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰
   - è°ƒé«˜ Timeout_ms åˆ° 2000-5000ms

2. **ä¼˜åŒ–å‚æ•°**ï¼ˆæ¨èï¼‰
   - å‡å°‘ Scale_Stepsï¼ˆå¦‚ä»20é™åˆ°5-10ï¼‰
   - é™ä½ Resize%ï¼ˆå¦‚ä»100é™åˆ°50-70ï¼‰
   - ä½¿ç”¨ROIç¼©å°æœç´¢èŒƒå›´
   - æé«˜é˜ˆå€¼å‡å°‘åŒ¹é…æ•°é‡

3. **è°ƒæ•´ç­–ç•¥**
   - å¦‚æœæ‰¾åˆ°äº†ç›®æ ‡ä½†è¶…æ—¶ï¼Œè¯´æ˜å‚æ•°å¯èƒ½è¿‡äºç²¾ç»†
   - å¦‚æœæ²¡æ‰¾åˆ°ç›®æ ‡ä¸”è¶…æ—¶ï¼Œå¯èƒ½éœ€è¦æ”¹å˜æœç´¢ç­–ç•¥

### 4. çƒ­åŠ›å›¾çš„ä½¿ç”¨

çƒ­åŠ›å›¾(View=2)å¯ä»¥å¸®åŠ©ä½ ï¼š
- ğŸ”¥ **çº¢è‰²åŒºåŸŸ**ï¼šé«˜åŒ¹é…åº¦
- ğŸ§Š **è“è‰²åŒºåŸŸ**ï¼šä½åŒ¹é…åº¦
- ç”¨é€”ï¼šæŸ¥çœ‹ä¸ºä»€ä¹ˆæŸäº›åŒºåŸŸè¢«è¯¯æ£€æˆ–æ¼æ£€

## åŒ¹é…æ–¹æ³•é€‰æ‹©æŒ‡å—

### TM_CCOEFF_NORMED (æ¨è)
- âœ… å¯¹å…‰ç…§å˜åŒ–è¾ƒé²æ£’
- âœ… å½’ä¸€åŒ–åç»“æœåœ¨-1åˆ°1ä¹‹é—´
- âœ… æœ€å¸¸ç”¨çš„æ–¹æ³•
- ğŸ“ é˜ˆå€¼æ¨èï¼š0.75-0.9

### TM_SQDIFF_NORMED
- âš ï¸ å€¼è¶Šå°è¶Šå¥½ï¼ˆæ³¨æ„æ˜¯ç›¸åçš„ï¼ï¼‰
- âœ… è®¡ç®—ç®€å•ï¼Œé€Ÿåº¦å¿«
- ğŸ“ é˜ˆå€¼æ¨èï¼š0.1-0.3ï¼ˆå°äºé˜ˆå€¼ä¸ºåŒ¹é…ï¼‰

### TM_CCORR_NORMED
- âš ï¸ å—äº®åº¦å½±å“è¾ƒå¤§
- ğŸ“ é˜ˆå€¼æ¨èï¼š0.85-0.95
- ğŸ’¡ ä¸æ¨èä½œä¸ºé¦–é€‰

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæ¨¡æ¿éœ€è¦å’Œç›®æ ‡å›¾åƒé¢œè‰²ä¸€è‡´ï¼Ÿ
A: æ¨¡æ¿åŒ¹é…æ˜¯åŸºäºåƒç´ ç›¸ä¼¼åº¦çš„æ–¹æ³•ï¼Œé¢œè‰²å·®å¼‚ä¼šå½±å“åŒ¹é…ç»“æœã€‚å¦‚æœé¢œè‰²å¯èƒ½å˜åŒ–ï¼Œå¯ä»¥å°è¯•ï¼š
- è½¬æ¢ä¸ºç°åº¦å›¾å†åŒ¹é…
- ä½¿ç”¨ç‰¹å¾ç‚¹åŒ¹é…æ–¹æ³•ï¼ˆSIFT/ORBï¼‰

### Q2: å¤šå°ºåº¦åŒ¹é…ä¼šå¾ˆæ…¢å—ï¼Ÿ
A: æ˜¯çš„ã€‚æ—¶é—´å¤æ‚åº¦ â‰ˆ O(å°ºåº¦æ•° Ã— å›¾åƒå¤§å°)ã€‚ä¼˜åŒ–æ–¹æ³•ï¼š
- å‡å°‘Scale_Steps
- ä½¿ç”¨Resize%é™ä½åˆ†è¾¨ç‡
- ä½¿ç”¨ROIå‡å°æœç´¢åŒºåŸŸ

### Q3: NMSæ˜¯ä»€ä¹ˆï¼Ÿ
A: éæå¤§å€¼æŠ‘åˆ¶ï¼ˆNon-Maximum Suppressionï¼‰ï¼Œç”¨äºå»é™¤é‡å çš„æ£€æµ‹æ¡†ã€‚å½“åŒä¸€ä¸ªç›®æ ‡è¢«å¤šæ¬¡æ£€æµ‹æ—¶ï¼Œä¿ç•™å¾—åˆ†æœ€é«˜çš„ï¼ŒæŠ‘åˆ¶å…¶ä»–é‡å çš„æ£€æµ‹ã€‚

### Q4: å¦‚ä½•å¤„ç†æ—‹è½¬çš„ç›®æ ‡ï¼Ÿ
A: æ¨¡æ¿åŒ¹é…å¯¹æ—‹è½¬ä¸é²æ£’ã€‚å»ºè®®ï¼š
- å‡†å¤‡å¤šä¸ªæ—‹è½¬è§’åº¦çš„æ¨¡æ¿
- ä½¿ç”¨ç‰¹å¾ç‚¹åŒ¹é…ï¼ˆORB/SIFTï¼‰
- ä½¿ç”¨æ·±åº¦å­¦ä¹ æ–¹æ³•ï¼ˆYOLOç­‰ï¼‰

## å®é™…åº”ç”¨ä»£ç ç¤ºä¾‹

è°ƒè¯•å®Œå‚æ•°åï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š

```python
import cv2
import numpy as np

def match_template_multiscale(image, template, threshold=0.85,
                               scale_min=0.9, scale_max=1.1, scale_steps=5):
    """å¤šå°ºåº¦æ¨¡æ¿åŒ¹é…"""
    image_gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
    template_gray = cv2.cvtColor(template, cv2.COLOR_BGR2GRAY)

    h, w = template_gray.shape
    all_matches = []

    for scale in np.linspace(scale_min, scale_max, scale_steps):
        scaled_w = int(w * scale)
        scaled_h = int(h * scale)

        if scaled_w > image_gray.shape[1] or scaled_h > image_gray.shape[0]:
            continue

        resized_template = cv2.resize(template_gray, (scaled_w, scaled_h))
        result = cv2.matchTemplate(image_gray, resized_template,
                                   cv2.TM_CCOEFF_NORMED)

        locations = np.where(result >= threshold)
        for pt in zip(*locations[::-1]):
            all_matches.append({
                'x': pt[0],
                'y': pt[1],
                'w': scaled_w,
                'h': scaled_h,
                'score': result[pt[1], pt[0]]
            })

    return all_matches

# ä½¿ç”¨
template = cv2.imread('template.png')
image = cv2.imread('screenshot.png')

matches = match_template_multiscale(image, template,
                                   threshold=0.85,
                                   scale_min=0.9,
                                   scale_max=1.1,
                                   scale_steps=5)

for match in matches:
    print(f"æ‰¾åˆ°ç›®æ ‡: ä½ç½®({match['x']}, {match['y']}), "
          f"å¤§å°({match['w']}x{match['h']}), "
          f"ç½®ä¿¡åº¦{match['score']:.2f}")
```

## æ€§èƒ½å¯¹æ¯”

ä¸åŒå‚æ•°ç»„åˆçš„å¤„ç†æ—¶é—´å‚è€ƒï¼ˆ1920x1080å›¾åƒï¼‰ï¼š

| é…ç½® | Scale_Steps | Resize% | ROI | å¤„ç†æ—¶é—´ |
|-----|-------------|---------|-----|---------|
| å¿«é€Ÿ | 3 | 50 | æ˜¯ | ~50ms |
| å¹³è¡¡ | 5 | 100 | æ˜¯ | ~200ms |
| ç²¾ç¡® | 10 | 100 | å¦ | ~800ms |
| æè‡´ | 20 | 100 | å¦ | ~1500ms |

## æ€»ç»“

### æ¨èå·¥ä½œæµç¨‹

1. **åˆå§‹è®¾ç½®**ï¼šä½¿ç”¨é»˜è®¤å‚æ•°å¿«é€Ÿæµ‹è¯•
2. **è°ƒæ•´é˜ˆå€¼**ï¼šç¡®ä¿èƒ½æ‰¾åˆ°ç›®æ ‡
3. **ä¼˜åŒ–å°ºåº¦**ï¼šè°ƒæ•´scaleèŒƒå›´è¦†ç›–ç›®æ ‡å¤§å°
4. **å»é™¤è¯¯æ£€**ï¼šä½¿ç”¨NMSæˆ–æé«˜é˜ˆå€¼
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šè®¾ç½®ROIå’Œé™ä½åˆ†è¾¨ç‡
6. **å¯¼å‡ºä»£ç **ï¼šæŒ‰`q`ä¿å­˜å‚æ•°

### å‚æ•°é€ŸæŸ¥è¡¨

```
å¿«é€Ÿæœç´¢ï¼š
  Method=0, Threshold=80, Scale=90-110(3æ­¥), NMS, Resize=50, Timeout=500ms

å¹³è¡¡æœç´¢ï¼š
  Method=0, Threshold=85, Scale=80-120(5æ­¥), NMS, Resize=100, Timeout=1000ms

ç²¾ç¡®æœç´¢ï¼š
  Method=0, Threshold=75, Scale=70-130(10æ­¥), NMS, Resize=100, Timeout=2000ms
```

ç¥ä½ è°ƒè¯•é¡ºåˆ©ï¼ğŸ¯
